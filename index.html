<html>
<head>
<title>Chat.js example
</title>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>

$(document).ready(function() {
  var socket = io.connect('http://boogiech.chat.jit.su');
  var identity = $('#identity');
  var controls = $('#controls');
  var username_in = $('#username_in');
  var message_in = $('#message_in');
  var chatwindow = $('#msgwindow');
  var send_btn = $('#send_btn');
  var login_btn = $('#login_btn');

  // incoming message
  socket.on('message', function(data) {
    // console.log(data);
    showMessage(data);
  });

  // logged in
  socket.on('status', function(data) {
    if (data.status == 'ready') {
      showControls();
    }
  });

  // input listeners
  send_btn.click(function() {
    sendMessage(message_in.val());
  });

  login_btn.click(function() {
    sendIdentity(username_in.val());
  });

  message_in.keypress(function(event) {
    // ENTER pressed
    if (event.which == 13) {
      sendMessage(message_in.val());
    }
  });

  username_in.keypress(function(event) {
    // ENTER pressed
    if (event.which == 13) {
      sendIdentity(username_in.val());
    }
  });

  // send our name to server
  function sendIdentity(name) {
    login_btn.attr('disabled', true);
    socket.emit('set name', name);
  }

  // hide identity box and show chat controls
  function showControls() {
    identity.hide();
    controls.show();
    
    message_in.focus();
  }

  // add message to chat window
  function showMessage(message) {
    var msg = '';
    if (message.name != undefined) {
      msg = '<div><strong>' + message.name + '</strong>: ' + message.body + '</div>';
    } else {
      msg = '<div>' + message.body + '</div>';
    }
    
    chatwindow.append(msg);
    chatwindow.scrollTop(chatwindow[0].scrollHeight);
  }

  // send message to server
  function sendMessage(message) {
    send_btn.attr('disabled', true);
    
    socket.emit('message', message);
    
    message_in.val('');
    send_btn.removeAttr('disabled');
    message_in.focus();
  }

  username_in.focus();
});
</script>
<style>
  #msgwindow {
    height: 300px;
    width: 600;
    border: 1px dashed;
    padding: 10px;
    overflow: auto;
  }

  #controls {
    margin-top: 10px;
  }

  #controls input[type="text"] {
    width: 550px;
    display: block;
    border: 1px solid #999;
    float: left;
    padding: 10px;
  }

  #identity {
    margin-top: 10px;
  }

  #identity label {
    float: left;
    padding: 10px;
    font-weight: bold;
  }

  #identity input[type="text"] {
    width: 430px;
    display: block;
    border: 1px solid #999;
    float: left;
    padding: 10px;
  }

  input[type="button"] {
    padding: 10px;
  }
</style>
</head>
<body>
  <div id="chatwindow">
  </div>
  <div id="controls" style="display: none;">
    <input id="message_in" type="text" name="message" />
    <input id="send_btn" type="button" name="send" value="Say!" />
  </div>
  <div id="identity">
    <label for="username">Enter your name:</label>
    <input id="username_in" type="text" name="username" />
    <input id="login_btn" type="button" name="login" value="Enter" />
  </div>
  <div id="users">
  </div>
</body>
</html>